# Base image for arm64
FROM arm64v8/ubuntu:20.04

# Install dependencies and Orthanc
RUN apt-get update && \
  apt-get install -y wget gnupg && \
  wget -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - && \
  echo "deb http://apt.postgresql.org/pub/repos/apt/ focal-pgdg main" > /etc/apt/sources.list.d/pgdg.list && \
  apt-get update && \
  wget -qO - https://packages.orthanc-server.com/orthanc.asc | apt-key add - && \
  echo "deb https://packages.orthanc-server.com stable main" > /etc/apt/sources.list.d/orthanc.list && \
  apt-get update && \
  apt-get install -y orthanc orthanc-postgresql && \
  apt-get clean && \
  rm -rf /var/lib/apt/lists/*

# Copy Orthanc configuration
COPY ./config/orthanc.json /etc/orthanc/orthanc.json

# Expose Orthanc ports
EXPOSE 4242 8042

# Start Orthanc
CMD ["orthanc", "/etc/orthanc/orthanc.json"]
